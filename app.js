
'use strict';
const DATA = { data: {"settings": {"authorName": "Ms. Asmaa Mahmoud Elhagrasy", "unitColor": "#4db6ff"}, "lessons": [{"id": "lesson1", "title": "Lesson 1 â€” Egypt: Gateway to Africa", "vocab": [{"en": "gateway", "ar": "Ø¨ÙˆØ§Ø¨Ø©", "eg": "Egypt is a gateway to Africa."}, {"en": "infrastructure", "ar": "Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ©", "eg": "New infrastructure connects countries."}, {"en": "partnership", "ar": "Ø´Ø±Ø§ÙƒØ©", "eg": "They signed a partnership agreement."}, {"en": "stability", "ar": "Ø§Ø³ØªÙ‚Ø±Ø§Ø±", "eg": "Stability helps trade grow."}, {"en": "manufactured", "ar": "Ù…ØµÙ†Ù‘ÙŽØ¹", "eg": "Egypt exports manufactured goods."}, {"en": "textiles", "ar": "Ù…Ù†Ø³ÙˆØ¬Ø§Øª", "eg": "Egyptian textiles are famous."}, {"en": "mutual", "ar": "Ù…ØªØ¨Ø§Ø¯Ù„", "eg": "It is a mutual benefit for both sides."}, {"en": "scholarships", "ar": "Ù…Ù†Ø­ Ø¯Ø±Ø§Ø³ÙŠØ©", "eg": "Universities offer scholarships to African students."}, {"en": "medical convoys", "ar": "Ù‚ÙˆØ§ÙÙ„ Ø·Ø¨ÙŠØ©", "eg": "Medical convoys are helping people."}, {"en": "clinics", "ar": "Ø¹ÙŠØ§Ø¯Ø§Øª", "eg": "New clinics are being built."}, {"en": "vaccines", "ar": "Ù„Ù‚Ø§Ø­Ø§Øª", "eg": "Vaccines protect children from disease."}, {"en": "research", "ar": "Ø¨Ø­Ø«", "eg": "They support joint research projects."}], "reading": {"sentences": ["Egypt is strengthening ties with African countries.", "New infrastructure links regions and supports trade.", "Partnerships improve stability across the continent.", "Egypt exports manufactured goods and textiles.", "Medical convoys and clinics support healthcare.", "Scholarships and research build future leaders."], "mcq": [{"q": "Egypt is a ______ to Africa.", "opts": ["gateway", "barrier", "desert", "island"], "a": 0}]}, "quiz": [{"q": "The word 'mutual' is closest in meaning to:", "opts": ["one-sided", "shared", "private", "random"], "a": 1}], "exam": [{"q": "'Textiles' refers to:", "opts": ["vehicles", "fabrics", "medicines", "roads"], "a": 1}]}, {"id": "lesson2", "title": "Lesson 2 â€” Voices from the Partnership", "vocab": [{"en": "integration", "ar": "Ø¯Ù…Ø¬", "eg": "Regional integration supports growth."}, {"en": "hybrid", "ar": "Ù‡Ø¬ÙŠÙ†", "eg": "They use a hybrid irrigation system."}, {"en": "expanding", "ar": "ÙŠØªÙˆØ³Ø¹", "eg": "Trade is expanding every year."}, {"en": "rural", "ar": "Ø±ÙŠÙÙŠ", "eg": "Rural areas need better services."}, {"en": "stable", "ar": "Ù…Ø³ØªÙ‚Ø±", "eg": "A stable market attracts investment."}, {"en": "funding", "ar": "ØªÙ…ÙˆÙŠÙ„", "eg": "The project received international funding."}, {"en": "cooperation", "ar": "ØªØ¹Ø§ÙˆÙ†", "eg": "Cooperation builds trust."}, {"en": "irrigation", "ar": "Ø±ÙŠ", "eg": "Solar-powered irrigation saves water."}, {"en": "solar-powered", "ar": "ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©", "eg": "Solar-powered pumps help farmers."}, {"en": "agriculture", "ar": "Ø²Ø±Ø§Ø¹Ø©", "eg": "Agriculture supports many families."}], "reading": {"sentences": ["Experts discuss trade with African countries.", "Projects aim to bring stable growth to rural areas.", "Solar-powered irrigation supports agriculture.", "Funding helps expand development projects.", "Partnerships encourage regional integration.", "Cooperation improves peopleâ€™s lives."], "mcq": [{"q": "Solar-powered systems are used in:", "opts": ["theaters", "irrigation", "music", "fashion"], "a": 1}]}, "quiz": [], "exam": []}, {"id": "lesson3", "title": "Lesson 3 â€” Egypt & Africa (Listening) + Grammar", "vocab": [{"en": "investing", "ar": "ÙŠØ³ØªØ«Ù…Ø±", "eg": "Companies are investing in energy projects."}, {"en": "contributing", "ar": "ÙŠØ³Ø§Ù‡Ù…", "eg": "Students are contributing new ideas."}, {"en": "providing", "ar": "ÙŠÙ‚Ø¯Ù…", "eg": "Doctors are providing medical help."}, {"en": "conferences", "ar": "Ù…Ø¤ØªÙ…Ø±Ø§Øª", "eg": "Leaders are holding conferences."}, {"en": "climate change", "ar": "ØªØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø®", "eg": "They are discussing climate change."}, {"en": "security", "ar": "Ø§Ù„Ø£Ù…Ù†", "eg": "Security is being discussed as well."}], "grammar": {"title": "Present Continuous â€” Active & Passive", "explain": ["Active: am/is/are + V-ing â†’ We are building a bridge.", "Passive: am/is/are + being + p.p. â†’ A bridge is being built.", "Use it for actions happening now or arranged future."], "mcq": [{"q": "Doctors ____ medical help now.", "opts": ["provide", "are providing", "is providing", "are provided"], "a": 1}]}, "reading": {"sentences": ["Egyptian companies are investing in energy and agriculture.", "African students are studying in Cairo and sharing ideas.", "Doctors are providing healthcare across the region.", "Conferences are being organized to discuss key issues.", "New projects are being launched this month.", "Bridges of trust are being built between nations."], "mcq": [{"q": "Choose the passive form: They are building a bridge.", "opts": ["They are a bridge building.", "A bridge is being built.", "A bridge is built.", "A bridge was being built."], "a": 1}]}, "quiz": [], "exam": []}, {"id": "lesson4", "title": "Lesson 4 â€” Success Stories in African Partnership", "vocab": [{"en": "enhance", "ar": "ÙŠØ¹Ø²Ø²", "eg": "Irrigation techniques enhance yields."}, {"en": "yields", "ar": "ØºÙ„Ø§Ù„ / Ù…Ø­Ø§ØµÙŠÙ„", "eg": "Farmers increased their yields."}, {"en": "milestone", "ar": "Ø¥Ù†Ø¬Ø§Ø² Ø¨Ø§Ø±Ø²", "eg": "The project was a major milestone."}, {"en": "capacity", "ar": "Ù‚Ø¯Ø±Ø§Øª", "eg": "Training builds local capacity."}, {"en": "collaboration", "ar": "ØªØ¹Ø§ÙˆÙ†", "eg": "Collaboration drives progress."}, {"en": "renewable energy", "ar": "Ø·Ø§Ù‚Ø© Ù…ØªØ¬Ø¯Ø¯Ø©", "eg": "Factories supply renewable energy."}], "reading": {"sentences": ["Farmers increased yields using modern irrigation.", "Large projects became milestones for cooperation.", "Medical teams built lasting capacity.", "Renewable energy factories created jobs.", "Cultural exchange supports mutual respect.", "An annual festival highlights African films."], "mcq": [{"q": "'Milestone' means:", "opts": ["big step", "small error", "road sign", "holiday"], "a": 0}]}, "quiz": [], "exam": []}], "unitExam": {"note": "Provisional", "items": [{"q": "Egypt is a regional ______ to Africa.", "opts": ["barrier", "gateway", "mountain", "storm"], "a": 1}, {"q": "'Infrastructure' refers to:", "opts": ["roads & systems", "sports", "music", "fashion"], "a": 0}, {"q": "Select the passive: They are launching programs.", "opts": ["Programs are being launched.", "Programs launched.", "Programs are launch.", "Programs will launch."], "a": 0}]}} };
// Helpers
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const SETTINGS = { authorName: DATA.data.settings.authorName, unitColor: DATA.data.settings.unitColor, sound:true, confetti:true, rate:0.9, voiceUri:'' };
const sndOk = new Audio('assets/sounds/correct.wav');
const sndBad = new Audio('assets/sounds/wrong.wav');
function burstConfetti(x=window.innerWidth/2,y=80){ if(!SETTINGS.confetti) return; const c=document.createElement('canvas'); c.width=innerWidth;c.height=innerHeight;c.className='confetti';document.body.appendChild(c);const g=c.getContext('2d');const ps=[...Array(120)].map(()=>({x:x+(Math.random()*120-60),y:y+(Math.random()*30-15),dx:Math.random()*2-1,dy:Math.random()*-3-2,s:Math.random()*6+2,h:Math.floor(Math.random()*360)}));let t=0; (function anim(){ g.clearRect(0,0,c.width,c.height); ps.forEach(p=>{p.x+=p.dx;p.y+=p.dy;p.dy+=0.06; g.fillStyle=`hsl(${p.h},90%,60%)`; g.fillRect(p.x,p.y,p.s,p.s);}); if(++t<120) requestAnimationFrame(anim); else c.remove(); })(); }
let voices=[]; function loadVoices(){ voices=speechSynthesis.getVoices(); const sel=$('#selVoice'); if(!sel) return; sel.innerHTML=''; const pref=voices.filter(v=>/en-GB|British/i.test(v.lang+v.name)); const arr=pref.concat(voices.filter(v=>!pref.includes(v)&&/en/i.test(v.lang))); arr.forEach(v=>{ const o=document.createElement('option'); o.value=v.voiceURI; o.textContent=`${v.name} â€” ${v.lang}`; if(!SETTINGS.voiceUri&&/en-GB|British/i.test(v.lang+v.name)) SETTINGS.voiceUri=v.voiceURI; sel.appendChild(o);}); if(SETTINGS.voiceUri) sel.value=SETTINGS.voiceUri; }
if('speechSynthesis' in window){ speechSynthesis.onvoiceschanged=loadVoices; setTimeout(loadVoices,300); }
function speak(t){ if(!('speechSynthesis' in window)) return alert('Speech not supported'); const u=new SpeechSynthesisUtterance(t); u.rate=SETTINGS.rate; u.pitch=1; u.lang='en-GB'; const v=voices.find(v=>v.voiceURI===SETTINGS.voiceUri)||voices.find(v=>/en-GB|British/i.test(v.lang+v.name))||voices.find(v=>/en/i.test(v.lang)); if(v) u.voice=v; speechSynthesis.speak(u); }
function init(){ document.documentElement.style.setProperty('--brand', SETTINGS.unitColor); $('#author').textContent=SETTINGS.authorName; buildPanels(); bindTabs(); bindSettings(); }
function bindTabs(){ $$('.unit-tabs .tab').forEach(btn=>btn.addEventListener('click',()=>{ $$('.unit-tabs .tab').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); const id=btn.dataset.tab; $$('#panelContainer > section').forEach(sec=>sec.style.display=(sec.id===id?'block':'none')); })); }
function buildPanels(){ const pc=$('#panelContainer'); pc.innerHTML=''; DATA.data.lessons.forEach(lesson=>{ const sec=document.createElement('section'); sec.id=lesson.id; sec.style.display=(lesson.id==='lesson1'?'block':'none'); sec.innerHTML=document.querySelector('#tplLesson').innerHTML; sec.querySelector('h2').textContent=lesson.title; pc.appendChild(sec); buildLesson(sec, lesson); }); const ex=document.createElement('section'); ex.id='unitExam'; ex.style.display='none'; ex.innerHTML=`<section class="lesson"><h2>Unit Exam â€” MCQ (Provisional)</h2><div class="card"><p class="kicker">Will be replaced with your official bank. Choices shuffle; correct answer shown after mistakes. Use Retry to reshuffle.</p></div><div class="subpanel exam">${renderExam(DATA.data.unitExam.items,'unit')}</div></section>`; pc.appendChild(ex); }
function buildLesson(root, lesson){ const vocabDiv=root.querySelector('.subpanel.vocab'); const grid=document.createElement('div'); grid.className='vocab-grid'; (lesson.vocab||[]).forEach(w=>{ const card=document.createElement('div'); card.className='card'; card.innerHTML=`<div class="word">${w.en} <button class="btn-ghost inline" data-say="${w.en}">ðŸ”Š</button></div><div class="meaning">${w.ar}</div><div class="kicker">e.g., ${w.eg} <button class="btn-ghost inline" data-say="${w.eg}">ðŸ”Š</button></div>`; grid.appendChild(card); }); const dict=document.createElement('div'); dict.className='card'; dict.innerHTML=`<h3>Dictation Practice</h3><p>Type the English word for the Arabic meaning shown. Press Enter to check.</p><div class="inline"><span id="dictAr"></span><input id="dictAns" placeholder="type English"/> <button id="btnCheck" class="btn">Check</button> <span id="dictMsg" class="kicker"></span></div>`; vocabDiv.appendChild(grid); vocabDiv.appendChild(dict); let di=0; let order=[...Array((lesson.vocab||[]).length).keys()]; order.sort(()=>Math.random()-0.5); function show(){ const w=lesson.vocab[order[di%order.length]]; root.querySelector('#dictAr').textContent=w.ar; root.querySelector('#dictAns').value=''; root.querySelector('#dictMsg').textContent=''; root.querySelector('#dictAns').focus(); }
 vocabDiv.addEventListener('click', e=>{ const b=e.target.closest('[data-say]'); if(b) speak(b.dataset.say); }); root.querySelector('#btnCheck').addEventListener('click',()=>{ const w=lesson.vocab[order[di%order.length]]; const ans=root.querySelector('#dictAns').value.trim().toLowerCase(); if(ans===w.en.toLowerCase()){ root.querySelector('#dictMsg').textContent='Great!'; root.querySelector('#dictMsg').style.color='var(--ok)'; if(SETTINGS.sound) sndOk.play(); burstConfetti(); di++; show(); } else { root.querySelector('#dictMsg').textContent=`Try again â†’ ${w.en}`; root.querySelector('#dictMsg').style.color='var(--bad)'; if(SETTINGS.sound) sndBad.play(); } }); root.querySelector('#dictAns').addEventListener('keydown',e=>{ if(e.key==='Enter') root.querySelector('#btnCheck').click(); }); show();
 const gamesDiv=root.querySelector('.subpanel.games'); gamesDiv.innerHTML = `<div class="card"><h3>Matching â€” Drag Arabic to the English word</h3><div class="game-flex"><div class="stack" id="left"></div><div class="stack" id="right"></div></div><button class="btn" id="btnResetMatch">Reset</button></div><div class="card"><h3>Quick Quiz</h3><div id="quiz"></div></div>`; const left=gamesDiv.querySelector('#left'), right=gamesDiv.querySelector('#right'); const leftItems=(lesson.vocab||[]).map((w,i)=>({id:i,text:w.en})).sort(()=>Math.random()-0.5); const rightItems=(lesson.vocab||[]).map((w,i)=>({id:i,text:w.ar})).sort(()=>Math.random()-0.5); leftItems.forEach(it=> left.appendChild(tile(it.text,it.id,'en'))); rightItems.forEach(it=> right.appendChild(tile(it.text,it.id,'ar'))); dnd(gamesDiv); gamesDiv.querySelector('#btnResetMatch').addEventListener('click',()=>{ left.innerHTML=''; right.innerHTML=''; (lesson.vocab||[]).map((w,i)=>({id:i,text:w.en})).sort(()=>Math.random()-0.5).forEach(it=> left.appendChild(tile(it.text,it.id,'en'))); (lesson.vocab||[]).map((w,i)=>({id:i,text:w.ar})).sort(()=>Math.random()-0.5).forEach(it=> right.appendChild(tile(it.text,it.id,'ar'))); dnd(gamesDiv); }); const qDiv=gamesDiv.querySelector('#quiz'); (lesson.quiz||[]).forEach((q,i)=> qDiv.appendChild(mcq(q, `${lesson.id}-q${i}`)) );
 const readDiv=root.querySelector('.subpanel.reading'); readDiv.innerHTML=`<div class="card"><h3>Listen & Read</h3><div id="sent"></div></div><div class="card"><h3>Check Understanding</h3><div id="rmcq"></div></div>`; const sDiv=readDiv.querySelector('#sent'); (lesson.reading?.sentences||[]).forEach(s=>{ const row=document.createElement('div'); row.className='sentence'; row.innerHTML=`<button class="play" aria-label="play">â–¶</button><span>${s}</span>`; row.querySelector('.play').addEventListener('click',()=> speak(s)); sDiv.appendChild(row); }); const rDiv=readDiv.querySelector('#rmcq'); (lesson.reading?.mcq||[]).forEach((q,i)=> rDiv.appendChild(mcq(q, `${lesson.id}-r${i}`)) );
 const examDiv=root.querySelector('.subpanel.exam'); examDiv.innerHTML = exam(lesson.exam||[], lesson.id);
 const tabs=root.querySelectorAll('.ltab'); tabs.forEach(b=> b.addEventListener('click',()=>{ tabs.forEach(x=>x.classList.remove('active')); b.classList.add('active'); root.querySelectorAll('.subpanel').forEach(p=>p.classList.add('hidden')); root.querySelector(`.subpanel.${b.dataset.sub}`).classList.remove('hidden'); })); }
function tile(text,id,side){ const d=document.createElement('div'); d.className='tile'; d.textContent=text; d.draggable=true; d.dataset.id=id; d.dataset.side=side; return d; }
function dnd(scope){ let drag=null; scope.querySelectorAll('.tile').forEach(t=>{ t.addEventListener('dragstart',()=>{ drag=t; t.classList.add('dragging'); }); t.addEventListener('dragend',()=>{ drag=null; t.classList.remove('dragging'); }); }); scope.querySelectorAll('.stack').forEach(st=>{ st.addEventListener('dragover',e=> e.preventDefault()); st.addEventListener('drop',e=>{ e.preventDefault(); if(!drag) return; st.appendChild(drag); const sibs=Array.from(st.parentElement.querySelectorAll('.tile')); sibs.forEach(a=>sibs.forEach(b=>{ if(a!==b && a.dataset.id===b.dataset.id && a.dataset.side!==b.dataset.side){ a.classList.add('correct'); b.classList.add('correct'); if(SETTINGS.sound) sndOk.play(); burstConfetti(); } })); }); }); }
function mcq(q,key){ const div=document.createElement('div'); div.className='qcard'; const opts=(q.opts||[]).map((t,i)=>({t,i})).sort(()=>Math.random()-0.5); div.innerHTML=`<div class="q">${q.q}</div>` + opts.map(o=>`<label class="opt"><input type="radio" name="${key}" value="${o.i}"> ${o.t}</label>`).join(''); div.addEventListener('change',e=>{ const v=parseInt(e.target.value,10); const labs=[...div.querySelectorAll('.opt')]; labs.forEach(lb=>{ const val=parseInt(lb.querySelector('input').value,10); lb.classList.remove('correct','wrong'); if(val===q.a && v===val){ lb.classList.add('correct'); if(SETTINGS.sound) sndOk.play(); burstConfetti(); } else if(val===v){ lb.classList.add('wrong'); if(SETTINGS.sound) sndBad.play(); } }); }); return div; }
function exam(items,ns){ let html=`<div class="exam-header"><div><strong>MCQ</strong> â€” Randomized answers</div><div class="score" id="score-${ns}">Score: 0 / ${items.length}</div></div>`; html+=`<div id="exam-${ns}"></div><div class="inline" style="margin-top:8px"><button class="btn" id="submit-${ns}">Submit</button><button class="btn-ghost" id="retry-${ns}">Retry</button></div>`; setTimeout(()=> mountExam(items,ns),0); return html; }
function mountExam(items,ns){ const host=document.getElementById(`exam-${ns}`); host.innerHTML=''; const nodes=[]; (items||[]).forEach((it,idx)=>{ const card=document.createElement('div'); card.className='qcard'; const opts=(it.opts||[]).map((t,i)=>({t,i})).sort(()=>Math.random()-0.5); card.innerHTML=`<div class="q">${idx+1}) ${it.q}</div>` + opts.map(o=>`<label class="opt"><input type="radio" name="${ns}-${idx}" value="${o.i}"> ${o.t}</label>`).join(''); host.appendChild(card); nodes.push({card,it,opts}); }); document.getElementById(`submit-${ns}`).onclick=()=>{ let score=0; nodes.forEach(({card,it,opts})=>{ const chosen=card.querySelector('input:checked'); const v = chosen? parseInt(chosen.value,10) : -1; const labs=card.querySelectorAll('.opt'); labs.forEach(lb=>lb.classList.remove('correct','wrong')); labs.forEach(lb=>{ const val=parseInt(lb.querySelector('input').value,10); if(val===it.a) lb.classList.add('correct'); if(val===v && v!==it.a) lb.classList.add('wrong'); }); if(v===it.a){ score++; if(SETTINGS.sound) sndOk.play(); } else { if(SETTINGS.sound) sndBad.play(); } }); document.getElementById(`score-${ns}`).textContent = `Score: ${score} / ${items.length}`; burstConfetti(); }; document.getElementById(`retry-${ns}`).onclick=()=> mountExam(items,ns); }
function shuffle(a){ const x=a.slice(); for(let i=x.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [x[i],x[j]]=[x[j],x[i]]; } return x; }
function bindSettings(){ const dlg=$('#dlgSettings'); $('#btnSettings').addEventListener('click',()=> dlg.showModal()); $('#chkSound').checked=SETTINGS.sound; $('#chkConfetti').checked=SETTINGS.confetti; $('#rngRate').value=SETTINGS.rate; $('#btnSaveSettings').addEventListener('click',()=>{ SETTINGS.sound=$('#chkSound').checked; SETTINGS.confetti=$('#chkConfetti').checked; SETTINGS.rate=parseFloat($('#rngRate').value); const sel=$('#selVoice'); if(sel && sel.value) SETTINGS.voiceUri=sel.value; }); }
window.addEventListener('DOMContentLoaded', init);
